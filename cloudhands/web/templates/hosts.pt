<html metal:use-macro="load: base.pt" lang="en">
<nav metal:fill-slot="nav" class="pure-menu pure-menu-open">
    <ul>
    <li class="pure-menu-heading" ><a href="/">JASMIN</a></li>
    <li><a href="#">Account</a></li>
    <li><a href="#">JVO</a></li>
    <li class="pure-menu-selected" ><a href="/hosts">VMs</a></li>
    </ul>
</nav>
<div metal:fill-slot="summary">
<section id="items">
<h1>Virtual machines</h1>
<table class="pure-table pure-table-horizontal">
<thead>
<tr><th>Organisation</th><th>Host</th><th>IP</th><th>Actions</th></tr>
</thead>
<tbody>
<tr
tal:repeat="(itemId, item) items.items()"
tal:attributes="
id itemId;
class python:' '.join('{0.fsm} {0.name}'.format(s) for s in item['states']);
">
<td tal:content="python: [i.ref for i in item['_links'] if i.rel == 'parent'][0]"></td>
<td>${item['name']}</td>
<td tal:switch="python: [s.name for s in item['states'] if s.fsm == 'host'][0]">
<i tal:case="'requested'" class="fa fa-spinner fa-spin"></i>
<p tal:omit-tag="" tal:content="python: item.data['ips'][0] if item.data['ips'] else None">
</td>
<td><a class="pure-button" tal:repeat="link item['_links']"
tal:attributes="href link.typ.format(link.ref)">
<i tal:condition="link.action == 'settings'" class="fa fa-cog"></i>
${link.action.capitalize()}</a></td>
</tr>
</tbody>
</table>
</section>
</div>
<section metal:fill-slot="detail" id="options">
<ul>
<li tal:repeat="option options.values()">
<form class="pure-form pure-form-aligned"
tal:define="link option['_links'][0]"
tal:attributes="
name string:${link.rel}_${link.method};
method link.method;
action link.typ.format(link.ref);
id string:option_${repeat['option'].index}">
<fieldset>
<legend>New VM</legend>
<div class="pure-control-group"
tal:repeat="field link.parameters">
<label
tal:content="field.name.upper() if field.name in ('cpu', 'jvo', 'ram') else field.name.capitalize()"
tal:attributes="for field.name">
</label>
<input
tal:condition="not field.values"
tal:attributes="
id string:${link.ref}_${link.method}_${field.name};
name field.name;
value python: field.name if not field.values else field.values[0] ;
pattern field.regex.pattern;
required python:'required' if field.required else None;
type python:'hidden' if field.name in ('',) else 'text';"/>
<select
tal:condition="field.values">
<option
tal:repeat="value field.values"
tal:content="value"
tal:attributes="
value value;
">
</option>
</select>
</div>
<div class="pure-control-group">
<button type="submit" class="pure-button pure-button-primary">${link.action}</button>
</div>
</fieldset>
</form>
</li>
</ul>
</section>
</html>
